<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ============================================================
         COMMISSION PAYOUT REPORT - PROFESSIONAL OSUS DESIGN
         Enhanced design with order summary, commission sections,
         VAT calculations, and company share computation
         
         Module: enhanced_status
         Template ID: commission_payout_report_template_final
         
         RATE FIELD MAPPINGS:
         - External: broker_rate, referrer_rate, cashback_rate, other_external_rate
         - Internal: manager_rate, director_rate, agent1_rate, agent2_rate
         - Legacy: consultant_comm_percentage, manager_comm_percentage
         ============================================================ -->
    
    <template id="commission_payout_report_template_final">
        <t t-name="enhanced_status.commission_report_document_final">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-set="o" t-value="o.with_context(lang=lang)"/>
                    <t t-set="format_date" t-value="lambda d: d.strftime('%d/%m/%Y') if d else ''"/>
                    <t t-set="format_number" t-value="lambda v: '{:,.2f}'.format(float(v)) if v else '0.00'"/>
                    <t t-set="format_rate" t-value="lambda v: '{:.2f}%'.format(float(v)) if v and float(v) > 0 else '0.00%'"/>
                    
                    <!-- Calculate commission totals -->
                    <t t-set="has_external" t-value="(o.broker_amount or 0) > 0 or (o.referrer_amount or 0) > 0 or (o.cashback_amount or 0) > 0 or (o.other_external_amount or 0) > 0"/>
                    <t t-set="has_internal" t-value="(o.agent1_amount or 0) > 0 or (o.agent2_amount or 0) > 0 or (o.manager_amount or 0) > 0 or (o.director_amount or 0) > 0"/>
                    <t t-set="has_legacy" t-value="(o.salesperson_commission or 0) > 0 or (o.manager_commission or 0) > 0"/>
                    
                    <t t-set="external_total" t-value="(o.broker_amount or 0) + (o.referrer_amount or 0) + (o.cashback_amount or 0) + (o.other_external_amount or 0)"/>
                    <t t-set="internal_total" t-value="(o.agent1_amount or 0) + (o.agent2_amount or 0) + (o.manager_amount or 0) + (o.director_amount or 0)"/>
                    <t t-set="legacy_total" t-value="(o.salesperson_commission or 0) + (o.manager_commission or 0)"/>
                    
                    <t t-set="total_commission" t-value="external_total + internal_total + legacy_total"/>
                    <t t-set="vat_on_commission" t-value="total_commission * 0.05"/>
                    <t t-set="total_commission_with_vat" t-value="total_commission + vat_on_commission"/>
                    <t t-set="company_share" t-value="o.amount_total - total_commission_with_vat"/>
                    
                    <div class="page" style="font-family: 'Arial', 'Helvetica', sans-serif; font-size: 11px; line-height: 1.4; color: #000; background-color: #ffffff; margin: 0; padding: 0;">
                        
                        <!-- Custom Header -->
                        <div style="background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%); padding: 20px 40px; border-bottom: 3px solid #8b1538; margin-bottom: 20px;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <tr>
                                    <td style="width: 30%; vertical-align: middle;">
                                        <img src="https://osusproperties.com/images/osus.png" alt="OSUS Properties" style="max-width: 120px; height: auto;"/>
                                    </td>
                                    <td style="width: 70%; vertical-align: top; text-align: right;">
                                        <div style="color: #333; font-size: 12px; line-height: 1.5;">
                                            <div style="font-weight: bold; font-size: 13px; margin-bottom: 3px;">OSUS REAL ESTATE BROKERAGE LLC</div>
                                            <div>Single Business Tower 29th Floor</div>
                                            <div>Business Bay Dubai</div>
                                            <div>United Arab Emirates</div>
                                            <div style="font-weight: bold; margin-top: 4px;">VAT: 100236589600003</div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <div style="padding: 0 40px;">
                            
                            <!-- Report Title Section -->
                            <div style="text-align: center; margin: 20px 0 25px 0; padding: 18px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; border-left: 5px solid #8b1538;">
                                <h1 style="font-size: 22px; color: #8b1538; margin: 0 0 10px 0; font-weight: bold; letter-spacing: 1px; text-transform: uppercase;">
                                    Commission Payout Report
                                </h1>
                                <div style="font-size: 13px; color: #666; margin-bottom: 8px;">
                                    Order: <strong style="color: #333;"><t t-esc="o.name"/></strong> | 
                                    Date: <strong style="color: #333;"><t t-esc="format_date(o.date_order)"/></strong>
                                </div>
                                <div style="font-size: 11px; color: #333; line-height: 1.8;">
                                    Customer: <strong style="color: #8b1538;"><t t-esc="o.partner_id.name"/></strong>
                                    <t t-if="o.project_id">
                                        | Project: <strong style="color: #8b1538;"><t t-esc="o.project_id.name"/></strong>
                                    </t>
                                    <t t-if="o.unit_id">
                                        | Unit: <strong style="color: #8b1538;"><t t-esc="o.unit_id.name"/></strong>
                                    </t>
                                </div>
                            </div>

                            <!-- Order Summary Section -->
                            <div style="background: #8b1538; color: white; padding: 10px 14px; font-weight: bold; font-size: 12px; text-transform: uppercase; margin: 18px 0 0 0; border-radius: 5px; letter-spacing: 0.5px;">
                                ORDER SUMMARY
                            </div>
                            <table style="width: 100%; border-collapse: collapse; margin: 0 0 18px 0; font-size: 10px; border: 1px solid #ddd; box-shadow: 0 2px 6px rgba(0,0,0,0.08);">
                                <thead>
                                    <tr>
                                        <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: left;">DESCRIPTION</th>
                                        <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: center;">QTY</th>
                                        <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: right;">UNIT PRICE (AED)</th>
                                        <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: right;">SUBTOTAL (AED)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="o.order_line" t-as="line">
                                        <tr style="background: white;">
                                            <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><t t-esc="line.name or line.product_id.name"/></td>
                                            <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: center;"><t t-esc="format_number(line.product_uom_qty)"/></td>
                                            <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(line.price_unit)"/></td>
                                            <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(line.price_subtotal)"/></td>
                                        </tr>
                                    </t>
                                    <tr style="background: #f0f0f0; font-weight: bold; font-size: 11px;">
                                        <td colspan="3" style="padding: 9px 8px; border: 1px solid #ddd; text-align: right;">Order Total (Excl. VAT) (AED):</td>
                                        <td style="padding: 9px 8px; border: 1px solid #ddd; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.amount_untaxed)"/></td>
                                    </tr>
                                    <t t-if="o.amount_tax and o.amount_tax > 0">
                                        <tr style="background: #f9f9f9; font-size: 10px;">
                                            <td colspan="3" style="padding: 9px 8px; border: 1px solid #ddd; text-align: right;">VAT (AED):</td>
                                            <td style="padding: 9px 8px; border: 1px solid #ddd; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.amount_tax)"/></td>
                                        </tr>
                                    </t>
                                    <tr style="background: #f0f0f0; font-weight: bold; font-size: 11px;">
                                        <td colspan="3" style="padding: 9px 8px; border: 1px solid #ddd; text-align: right;">Order Total with VAT (AED):</td>
                                        <td style="padding: 9px 8px; border: 1px solid #ddd; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.amount_total)"/></td>
                                    </tr>
                                </tbody>
                            </table>

                            <t t-if="has_external or has_internal or has_legacy">
                                
                                <!-- External Commissions Section -->
                                <t t-if="has_external">
                                    <div style="background: #8b1538; color: white; padding: 10px 14px; font-weight: bold; font-size: 12px; text-transform: uppercase; margin: 18px 0 0 0; border-radius: 5px; letter-spacing: 0.5px;">
                                        EXTERNAL COMMISSIONS
                                    </div>
                                    <table style="width: 100%; border-collapse: collapse; margin: 0 0 18px 0; font-size: 10px; border: 1px solid #ddd; box-shadow: 0 2px 6px rgba(0,0,0,0.08);">
                                        <thead>
                                            <tr>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: left;">PARTY</th>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: left;">PARTNER</th>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: left;">CALCULATION BASIS</th>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: center;">RATE (%)</th>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: right;">AMOUNT (AED)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr t-if="o.broker_partner_id and o.broker_amount and o.broker_amount > 0" style="background: white;">
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><strong>Broker</strong></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><t t-esc="o.broker_partner_id.name"/></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;">
                                                    <t t-if="o.broker_calculation_base == 'unit_price'">Unit Price / Sales Value</t>
                                                    <t t-elif="o.broker_calculation_base == 'order_total_untaxed'">Order Total (Without Tax)</t>
                                                    <t t-elif="o.broker_calculation_base == 'order_total'">Order Total (With Tax)</t>
                                                    <t t-else="">Percentage</t>
                                                </td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: center;"><t t-if="o.broker_rate and o.broker_rate > 0 and o.broker_rate &lt;= 100"><t t-esc="format_rate(o.broker_rate)"/></t><t t-else="">Fix Amount</t></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.broker_amount)"/></td>
                                            </tr>
                                            <tr t-if="o.referrer_partner_id and o.referrer_amount and o.referrer_amount > 0" style="background: #f9f9f9;">
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><strong>Referrer</strong></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><t t-esc="o.referrer_partner_id.name"/></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;">
                                                    <t t-if="o.referrer_calculation_base == 'unit_price'">Unit Price / Sales Value</t>
                                                    <t t-elif="o.referrer_calculation_base == 'order_total_untaxed'">Order Total (Without Tax)</t>
                                                    <t t-elif="o.referrer_calculation_base == 'order_total'">Order Total (With Tax)</t>
                                                    <t t-else="">Percentage</t>
                                                </td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: center;"><t t-if="o.referrer_rate and o.referrer_rate > 0 and o.referrer_rate &lt;= 100"><t t-esc="format_rate(o.referrer_rate)"/></t><t t-else="">Fix Amount</t></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.referrer_amount)"/></td>
                                            </tr>
                                            <tr t-if="o.cashback_partner_id and o.cashback_amount and o.cashback_amount > 0" style="background: white;">
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><strong>Cashback</strong></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><t t-esc="o.cashback_partner_id.name"/></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;">
                                                    <t t-if="o.cashback_calculation_base == 'unit_price'">Unit Price / Sales Value</t>
                                                    <t t-elif="o.cashback_calculation_base == 'order_total_untaxed'">Order Total (Without Tax)</t>
                                                    <t t-elif="o.cashback_calculation_base == 'order_total'">Order Total (With Tax)</t>
                                                    <t t-else="">Percentage</t>
                                                </td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: center;"><t t-if="o.cashback_rate and o.cashback_rate > 0 and o.cashback_rate &lt;= 100"><t t-esc="format_rate(o.cashback_rate)"/></t><t t-else="">Fix Amount</t></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.cashback_amount)"/></td>
                                            </tr>
                                            <tr t-if="o.other_external_partner_id and o.other_external_amount and o.other_external_amount > 0" style="background: #f9f9f9;">
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><strong>Other External</strong></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><t t-esc="o.other_external_partner_id.name"/></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;">
                                                    <t t-if="o.other_external_calculation_base == 'unit_price'">Unit Price / Sales Value</t>
                                                    <t t-elif="o.other_external_calculation_base == 'order_total_untaxed'">Order Total (Without Tax)</t>
                                                    <t t-elif="o.other_external_calculation_base == 'order_total'">Order Total (With Tax)</t>
                                                    <t t-else="">Percentage</t>
                                                </td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: center;"><t t-if="o.other_external_rate and o.other_external_rate > 0 and o.other_external_rate &lt;= 100"><t t-esc="format_rate(o.other_external_rate)"/></t><t t-else="">Fix Amount</t></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.other_external_amount)"/></td>
                                            </tr>
                                            <tr style="background: #e8e8e8; font-weight: bold; border-top: 2px solid #8b1538; font-size: 11px;">
                                                <td colspan="4" style="padding: 9px 8px; border: 1px solid #ddd; text-align: right;">Total External (AED):</td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(external_total)"/></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </t>

                                <!-- Internal Commissions Section -->
                                <t t-if="has_internal">
                                    <div style="background: #8b1538; color: white; padding: 10px 14px; font-weight: bold; font-size: 12px; text-transform: uppercase; margin: 18px 0 0 0; border-radius: 5px; letter-spacing: 0.5px;">
                                        INTERNAL COMMISSIONS
                                    </div>
                                    <table style="width: 100%; border-collapse: collapse; margin: 0 0 18px 0; font-size: 10px; border: 1px solid #ddd; box-shadow: 0 2px 6px rgba(0,0,0,0.08);">
                                        <thead>
                                            <tr>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: left;">ROLE</th>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: left;">PARTNER</th>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: left;">CALCULATION BASIS</th>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: center;">RATE (%)</th>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: right;">AMOUNT (AED)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr t-if="o.manager_partner_id and o.manager_amount and o.manager_amount > 0" style="background: white;">
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><strong>Manager</strong></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><t t-esc="o.manager_partner_id.name"/></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;">
                                                    <t t-if="o.manager_calculation_base == 'unit_price'">Unit Price / Sales Value</t>
                                                    <t t-elif="o.manager_calculation_base == 'order_total_untaxed'">Order Total (Without Tax)</t>
                                                    <t t-elif="o.manager_calculation_base == 'order_total'">Order Total (With Tax)</t>
                                                    <t t-else="">Percentage</t>
                                                </td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: center;"><t t-if="o.manager_rate and o.manager_rate > 0 and o.manager_rate &lt;= 100"><t t-esc="format_rate(o.manager_rate)"/></t><t t-else="">Fix Amount</t></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.manager_amount)"/></td>
                                            </tr>
                                            <tr t-if="o.director_partner_id and o.director_amount and o.director_amount > 0" style="background: #f9f9f9;">
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><strong>Director</strong></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><t t-esc="o.director_partner_id.name"/></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;">
                                                    <t t-if="o.director_calculation_base == 'unit_price'">Unit Price / Sales Value</t>
                                                    <t t-elif="o.director_calculation_base == 'order_total_untaxed'">Order Total (Without Tax)</t>
                                                    <t t-elif="o.director_calculation_base == 'order_total'">Order Total (With Tax)</t>
                                                    <t t-else="">Percentage</t>
                                                </td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: center;"><t t-if="o.director_rate and o.director_rate > 0 and o.director_rate &lt;= 100"><t t-esc="format_rate(o.director_rate)"/></t><t t-else="">Fix Amount</t></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.director_amount)"/></td>
                                            </tr>
                                            <tr t-if="o.agent1_partner_id and o.agent1_amount and o.agent1_amount > 0" style="background: white;">
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><strong>Agent 1</strong></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><t t-esc="o.agent1_partner_id.name"/></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;">
                                                    <t t-if="o.agent1_calculation_base == 'unit_price'">Unit Price / Sales Value</t>
                                                    <t t-elif="o.agent1_calculation_base == 'order_total_untaxed'">Order Total (Without Tax)</t>
                                                    <t t-elif="o.agent1_calculation_base == 'order_total'">Order Total (With Tax)</t>
                                                    <t t-else="">Percentage</t>
                                                </td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: center;"><t t-if="o.agent1_rate and o.agent1_rate > 0 and o.agent1_rate &lt;= 100"><t t-esc="format_rate(o.agent1_rate)"/></t><t t-else="">Fix Amount</t></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.agent1_amount)"/></td>
                                            </tr>
                                            <tr t-if="o.agent2_partner_id and o.agent2_amount and o.agent2_amount > 0" style="background: #f9f9f9;">
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><strong>Agent 2</strong></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><t t-esc="o.agent2_partner_id.name"/></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;">
                                                    <t t-if="o.agent2_calculation_base == 'unit_price'">Unit Price / Sales Value</t>
                                                    <t t-elif="o.agent2_calculation_base == 'order_total_untaxed'">Order Total (Without Tax)</t>
                                                    <t t-elif="o.agent2_calculation_base == 'order_total'">Order Total (With Tax)</t>
                                                    <t t-else="">Percentage</t>
                                                </td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: center;"><t t-if="o.agent2_rate and o.agent2_rate > 0 and o.agent2_rate &lt;= 100"><t t-esc="format_rate(o.agent2_rate)"/></t><t t-else="">Fix Amount</t></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.agent2_amount)"/></td>
                                            </tr>
                                            <tr style="background: #e8e8e8; font-weight: bold; border-top: 2px solid #8b1538; font-size: 11px;">
                                                <td colspan="4" style="padding: 9px 8px; border: 1px solid #ddd; text-align: right;">Total Internal (AED):</td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(internal_total)"/></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </t>

                                <!-- Legacy Commissions Section -->
                                <t t-if="has_legacy">
                                    <div style="background: #8b1538; color: white; padding: 10px 14px; font-weight: bold; font-size: 12px; text-transform: uppercase; margin: 18px 0 0 0; border-radius: 5px; letter-spacing: 0.5px;">
                                        LEGACY COMMISSIONS
                                    </div>
                                    <table style="width: 100%; border-collapse: collapse; margin: 0 0 18px 0; font-size: 10px; border: 1px solid #ddd; box-shadow: 0 2px 6px rgba(0,0,0,0.08);">
                                        <thead>
                                            <tr>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: left;">ROLE</th>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: left;">PARTNER</th>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: left;">TYPE</th>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: center;">RATE (%)</th>
                                                <th style="background: #f5f5f5; padding: 10px 8px; border: 1px solid #ddd; font-weight: bold; font-size: 10px; text-align: right;">AMOUNT (AED)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr t-if="o.consultant_id and o.salesperson_commission and o.salesperson_commission > 0" style="background: white;">
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><strong>Consultant</strong></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><t t-esc="o.consultant_id.name"/></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;">Legacy Calculation</td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: center;"><t t-if="o.consultant_comm_percentage and o.consultant_comm_percentage > 0 and o.consultant_comm_percentage &lt;= 100"><t t-esc="format_rate(o.consultant_comm_percentage)"/></t><t t-else="">Fix Amount</t></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.salesperson_commission)"/></td>
                                            </tr>
                                            <tr t-if="o.manager_id and o.manager_commission and o.manager_commission > 0" style="background: #f9f9f9;">
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><strong>Manager (Legacy)</strong></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;"><t t-esc="o.manager_id.name"/></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px;">Legacy Calculation</td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: center;"><t t-if="o.manager_comm_percentage and o.manager_comm_percentage > 0 and o.manager_comm_percentage &lt;= 100"><t t-esc="format_rate(o.manager_comm_percentage)"/></t><t t-else="">Fix Amount</t></td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; font-size: 10px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.manager_commission)"/></td>
                                            </tr>
                                            <tr style="background: #e8e8e8; font-weight: bold; border-top: 2px solid #8b1538; font-size: 11px;">
                                                <td colspan="4" style="padding: 9px 8px; border: 1px solid #ddd; text-align: right;">Total Legacy (AED):</td>
                                                <td style="padding: 9px 8px; border: 1px solid #ddd; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(legacy_total)"/></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </t>

                                <!-- Commission Summary Section -->
                                <div style="background: #8b1538; color: white; padding: 10px 14px; font-weight: bold; font-size: 12px; text-transform: uppercase; margin: 18px 0 0 0; border-radius: 5px; letter-spacing: 0.5px;">
                                    COMMISSION SUMMARY
                                </div>
                                <table style="width: 100%; border-collapse: collapse; margin: 0 0 18px 0; font-size: 10px; border: 1px solid #ddd; box-shadow: 0 2px 6px rgba(0,0,0,0.08);">
                                    <tbody>
                                        <tr style="background: #f9f9f9; font-size: 10px;">
                                            <td colspan="4" style="padding: 9px 8px; border: 1px solid #ddd; text-align: right;">Total Order with VAT (AED):</td>
                                            <td style="padding: 9px 8px; border: 1px solid #ddd; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(o.amount_total)"/></td>
                                        </tr>
                                        <tr style="background: #f9f9f9; font-size: 10px;">
                                            <td colspan="4" style="padding: 9px 8px; border: 1px solid #ddd; text-align: right;">Total Payable Commission (External + Internal + Legacy) (AED):</td>
                                            <td style="padding: 9px 8px; border: 1px solid #ddd; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(total_commission)"/></td>
                                        </tr>
                                        <tr style="background: #f9f9f9; font-size: 10px;">
                                            <td colspan="4" style="padding: 9px 8px; border: 1px solid #ddd; text-align: right;">VAT on Commission (5%) (AED):</td>
                                            <td style="padding: 9px 8px; border: 1px solid #ddd; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><t t-esc="format_number(vat_on_commission)"/></td>
                                        </tr>
                                        <tr style="background: #e3f2fd; font-weight: bold; font-size: 11px; border-top: 2px solid #8b1538;">
                                            <td colspan="4" style="padding: 9px 8px; border: 1px solid #ddd; text-align: right;"><strong>Total Commission + VAT (AED):</strong></td>
                                            <td style="padding: 9px 8px; border: 1px solid #ddd; text-align: right; font-family: 'Courier New', monospace; font-weight: 600;"><strong><t t-esc="format_number(total_commission_with_vat)"/></strong></td>
                                        </tr>
                                        <tr style="background: #8b1538; color: white; font-weight: bold; font-size: 12px;">
                                            <td colspan="4" style="padding: 9px 8px; border: 1px solid #ddd; text-align: right;"><strong>TOTAL COMPANY SHARE (AED):</strong></td>
                                            <td style="padding: 9px 8px; border: 1px solid #ddd; text-align: right;"><strong><t t-esc="format_number(company_share)"/></strong></td>
                                        </tr>
                                    </tbody>
                                </table>

                                <div style="background: #f0f8ff; padding: 12px 15px; border-left: 4px solid #8b1538; margin: 15px 0; border-radius: 4px; font-size: 10px;">
                                    <strong style="color: #8b1538;">Calculation Formula:</strong><br/>
                                    <span style="font-size: 9px; color: #555; line-height: 1.7;">
                                        Total Company Share = Total Order with VAT - (Total Payable Commission + VAT on Commission)<br/>
                                        <strong><t t-esc="format_number(company_share)"/> = <t t-esc="format_number(o.amount_total)"/> - (<t t-esc="format_number(total_commission)"/> + <t t-esc="format_number(vat_on_commission)"/>)</strong>
                                    </span>
                                </div>
                            </t>

                            <t t-if="not has_external and not has_internal and not has_legacy">
                                <div style="text-align: center; padding: 35px 20px; color: #6c757d; font-style: italic; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; border: 2px dashed #dee2e6; margin: 20px 0;">
                                    <h4 style="color: #8b1538; font-size: 13px; margin-bottom: 8px;">No Commissions Configured</h4>
                                    <p style="margin: 0;">This sales order does not have any commission arrangements set up at this time.</p>
                                    <p style="margin-top: 8px; font-size: 9px;">Please configure commission rates and partners in the order details.</p>
                                </div>
                            </t>

                            <div style="margin-top: 30px; padding: 15px; background-color: #f8f9fa; border-left: 4px solid #8b1538;">
                                <p style="margin: 0; color: #8b1538; font-weight: bold; font-size: 13px;">âš  CONFIDENTIAL DOCUMENT - INTERNAL USE ONLY</p>
                                <p style="margin: 5px 0 0 0; color: #000; font-size: 12px;">This commission report is for internal use only and contains confidential financial information.</p>
                            </div>

                        </div>

                        <div style="background-color: #f5f5f5; border-top: 3px solid #8b1538; padding: 15px 40px; margin-top: 30px;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <tr>
                                    <td style="width: 33%; vertical-align: middle; font-size: 12px;">
                                        <div style="margin-bottom: 3px;">
                                            <strong style="color: #8b1538;">Phone:</strong> <span style="color: #000;">+971 4 336 4500</span>
                                        </div>
                                        <div>
                                            <strong style="color: #8b1538;">Email:</strong> <span style="color: #000;">info@osusproperties.com</span>
                                        </div>
                                    </td>
                                    <td style="width: 34%; text-align: center; vertical-align: middle; font-size: 12px;">
                                        <div>
                                            <a href="http://www.osusproperties.com" style="color: #8b1538; text-decoration: none; font-weight: bold;">www.osusproperties.com</a>
                                        </div>
                                    </td>
                                    <td style="width: 33%; text-align: right; vertical-align: middle;">
                                        <div style="color: #000; font-weight: bold; font-size: 11px;">
                                            This is a computer generated document. No signature or stamp required.
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>

    <record id="paperformat_commission_report" model="report.paperformat">
        <field name="name">Commission Report A4</field>
        <field name="default" eval="False"/>
        <field name="format">A4</field>
        <field name="page_height">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">5</field>
        <field name="margin_bottom">5</field>
        <field name="margin_left">7</field>
        <field name="margin_right">7</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">0</field>
        <field name="dpi">90</field>
    </record>

    <record id="commission_payout_report" model="ir.actions.report">
        <field name="name">Commission Payout Report</field>
        <field name="model">sale.order</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">enhanced_status.commission_payout_report_template_final</field>
        <field name="report_file">enhanced_status.commission_payout_report_template_final</field>
        <field name="print_report_name">'Commission Report - %s' % (object.name)</field>
        <field name="binding_model_id" ref="sale.model_sale_order"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="paperformat_commission_report"/>
    </record>
</odoo>
