<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Simplified Sale Order Form View -->
    <record id="view_order_form_enhanced_simple" model="ir.ui.view">
        <field name="name">sale.order.form.enhanced.simple</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="priority">20</field>
        <field name="arch" type="xml">

            <!-- Replace complex state with simple workflow -->
            <xpath expr="//field[@name='state']" position="replace">
                <field name="state" widget="statusbar" statusbar_visible="draft,sale,done" statusbar_colors='{"done":"success","sale":"info"}'/>
            </xpath>

            <!-- Add essential control fields -->
            <xpath expr="//field[@name='state']" position="after">
                <!-- Custom workflow fields -->
                <field name="is_locked" invisible="1"/>
                <field name="can_unlock" invisible="1"/>
                <field name="has_due" invisible="1"/>
                <field name="is_warning" invisible="1"/>

                <!-- Core fields required by parent view domains/attributes -->
                <!-- These fields are referenced in parent view domains and MUST be present -->
                <field name="company_id" invisible="1"/>
                <field name="partner_id" invisible="1"/>
                <field name="partner_shipping_id" invisible="1"/>
                <field name="partner_invoice_id" invisible="1"/>
                <field name="pricelist_id" invisible="1"/>
                <field name="currency_id" invisible="1"/>
                <field name="fiscal_position_id" invisible="1"/>
                <field name="user_id" invisible="1"/>
                <field name="team_id" invisible="1"/>
                <field name="tax_country_id" invisible="1"/>

                <!-- State and status fields used in attributes/modifiers -->
                <field name="invoice_status" invisible="1"/>
                <field name="locked" invisible="1"/>

                <!-- Date fields used in readonly/invisible conditions -->
                <field name="date_order" invisible="1"/>
                <field name="commitment_date" invisible="1"/>
                <field name="expected_date" invisible="1"/>

                <!-- Financial calculation fields -->
                <field name="amount_untaxed" invisible="1"/>
                <field name="amount_tax" invisible="1"/>
                <field name="amount_total" invisible="1"/>
                <field name="tax_calculation_rounding_method" invisible="1"/>

                <!-- Delivery module fields (if delivery module is installed) -->
                <field name="delivery_set" invisible="1"/>
                <field name="is_all_service" invisible="1"/>
                <field name="recompute_delivery_price" invisible="1"/>
                <field name="carrier_id" invisible="1"/>
            </xpath>

            <!-- Simplify buttons - keep only essential ones -->
            <xpath expr="//button[@name='action_quotation_send']" position="after">
                <!-- Simple workflow buttons -->
                <button name="action_complete_order" type="object" string="Mark Complete" class="btn-success" invisible="state != 'sale'" help="Mark order as completed"/>
                <button name="action_unlock_order" type="object" string="ðŸ”“ Unlock" class="btn-warning" invisible="not is_locked or not can_unlock" confirm="Unlock this order for editing?" help="Unlock order (Admin only)"/>
            </xpath>

            <!-- Add sale order type field after partner_id to avoid inheritance conflicts -->
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="sale_order_type_id" readonly="is_locked and not can_unlock" options="{'no_create': True}"/>
            </xpath>

            <!-- Simplify the sale header group - keep it minimal but include important tracking fields -->
            <xpath expr="//group[@name='sale_header']" position="replace">
                <group name="sale_header">
                    <group name="customer_info">
                        <field name="partner_id" readonly="is_locked and not can_unlock"/>
                        <field name="opportunity_id" string="CRM Lead ID" readonly="is_locked and not can_unlock"/>
                        <field name="date_order" readonly="is_locked and not can_unlock"/>
                        <field name="user_id" readonly="is_locked and not can_unlock"/>
                    </group>
                    <group name="order_details">
                        <field name="validity_date" readonly="is_locked and not can_unlock"/>
                        <field name="client_order_ref" readonly="is_locked and not can_unlock"/>
                        <field name="payment_term_id" readonly="is_locked and not can_unlock"/>
                    </group>
                </group>
            </xpath>

            <!-- Keep essential buttons but simplified -->
            <xpath expr="//button[@name='action_confirm']" position="attributes">
                <attribute name="string">Confirm Order</attribute>
            </xpath>

            <!-- Override order_line fields in the standard "Order Lines" tab to show percentage -->
            <xpath expr="//field[@name='order_line']//tree//field[@name='product_uom_qty']" position="attributes">
                <attribute name="widget">percentage</attribute>
                <attribute name="digits">[16, 2]</attribute>
            </xpath>

            <xpath expr="//field[@name='order_line']//tree//field[@name='qty_invoiced']" position="attributes">
                <attribute name="widget">percentage</attribute>
                <attribute name="digits">[16, 2]</attribute>
            </xpath>

        </field>
    </record>

    <!-- Override Invoice Form to show quantity as percentage -->
    <record id="view_move_form_percentage_qty" model="ir.ui.view">
        <field name="name">account.move.form.percentage.qty</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <!-- Override invoice line quantity field to show percentage -->
            <xpath expr="//field[@name='invoice_line_ids']//tree//field[@name='quantity']" position="attributes">
                <attribute name="widget">percentage</attribute>
                <attribute name="digits">[16, 2]</attribute>
            </xpath>
        </field>
    </record>

</odoo>