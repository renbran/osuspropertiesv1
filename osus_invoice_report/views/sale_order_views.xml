<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Status Change Wizard Form - FIXED -->
    <record id="view_order_status_change_wizard" model="ir.ui.view">
        <field name="name">order.status.change.wizard.form</field>
        <field name="model">order.status.change.wizard</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_title">
                        <h1>Change Order Status</h1>
                    </div>
                    <!-- Order Information -->
                    <group string="Order Information">
                        <group>
                            <field name="order_id" invisible="1"/>
                            <field name="order_name" readonly="1"/>
                            <field name="order_partner" readonly="1"/>
                        </group>
                        <group>
                            <field name="order_currency" invisible="1"/>
                            <field name="order_amount" readonly="1"/>
                        </group>
                    </group>
                    <!-- Status Change -->
                    <group string="Status Change">
                        <group>
                            <field name="current_status_id" readonly="1"/>
                            <field name="new_status_id" required="1" options="{'no_create': True, 'no_edit': True}"/>
                        </group>
                        <group>
                            <field name="transition_allowed" invisible="1"/>
                            <field name="warning_message" invisible="1"/>
                        </group>
                    </group>
                    <!-- Warning/Info Messages -->
                    <div class="alert alert-warning" role="alert" invisible="warning_message == False">
                        <strong>Note:</strong>
                        <field name="warning_message"/>
                    </div>
                    <div class="alert alert-danger" role="alert" invisible="transition_allowed == True">
                        <strong>Transition Not Allowed</strong>
                        <p>This status transition is not permitted by the workflow rules.</p>
                    </div>
                    <!-- Notes -->
                    <group string="Notes">
                        <field name="notes" nolabel="1" placeholder="Add optional notes about this status change..."/>
                    </group>
                </sheet>
                <footer>
                    <button name="change_status" string="Change Status" type="object" class="btn-primary" invisible="transition_allowed == False"/>
                    <button name="action_preview_change" string="Preview" type="object" class="btn-info" invisible="transition_allowed == False"/>
                    <button string="Cancel" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>
    <!-- End of Status Change Wizard Form -->

    <!-- Sale Order Form: Add Project/Unit Fields -->
    <record id="view_sale_order_form_project_unit" model="ir.ui.view">
        <field name="name">sale.order.form.project.unit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//sheet/group" position="inside">
                <group string="Project Info">
                    <field name="project_id"/>
                    <field name="unit_id"/>
                    <field name="project_unit"/>
                </group>
            </xpath>
        </field>
    </record>
    <!-- End Sale Order Form Patch -->
</odoo>
